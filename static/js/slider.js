// Tasks and Data
const tasks = ["teaser", "tryon", "stylization", "character"];

const data = {
    "teaser": {
        "use_20": false,
        "use_two_sided": true,
        "data": [
            {
                title: [
                    "A happy person, standing on a branch, climbing a tree, surrounded by a dense jungle",
                    "A joyful person, standing on a board, surfing a wave, in the ocean",
                    "An angry person, leaning forward, riding a bicycle on a cobblestone street, surrounded by old buildings",
                    "A focused person, sitting on a rock, sketching on paper, with mountains in the background",
                    "A focused person, kneeling down, planting flowers, with a modern house in the background",
                    "A peaceful person, sitting, playing guitar at sunset, with a colorful sky in the background",
                    "A happy person, stirring something in a pan, cooking a meal, in a modern kitchen",
                    "A heroic person, riding a beautiful unicorn, galloping through a rainbow, in a fantasy landscape",
                    "A playful person, jumping in puddles, having fun in the rain, in a city street",
                    "A busy person, typing on a laptop, working diligently, in a modern office",
                    "A delighted person, opening a gift, celebrating Christmas, in front of a Christmas tree",
                    "A thoughtful person, looking out a window, reflecting on life, in a cozy room",
                ],
                input_image: "static/images/teaser_webp/ppr10k_1/input.webp",
                images: [
                    "static/images/teaser_webp/ppr10k_1/jungle.webp",
                    "static/images/teaser_webp/ppr10k_1/surfing.webp",
                    "static/images/teaser_webp/ppr10k_1/bicycle.webp",
                    "static/images/teaser_webp/ppr10k_1/sketch.webp",
                    "static/images/teaser_webp/ppr10k_1/flower.webp",
                    "static/images/teaser_webp/ppr10k_1/guitar.webp",
                    "static/images/teaser_webp/ppr10k_1/cooking.webp",
                    "static/images/teaser_webp/ppr10k_1/unicorn.webp",
                    "static/images/teaser_webp/ppr10k_1/rainy.webp",
                    "static/images/teaser_webp/ppr10k_1/laptop.webp",
                    "static/images/teaser_webp/ppr10k_1/gift.webp",
                    "static/images/teaser_webp/ppr10k_1/reflect.webp",
                ]
            },

            {
                title: [
                    "A happy person, standing on a branch, climbing a tree, surrounded by a dense jungle",
                    "A joyful person, standing on a board, surfing a wave, in the ocean",
                    "An angry person, leaning forward, riding a bicycle on a cobblestone street, surrounded by old buildings",
                    "A focused person, sitting on a rock, sketching on paper, with mountains in the background",
                    "A focused person, kneeling down, planting flowers, with a modern house in the background",
                    "A peaceful person, sitting, playing guitar at sunset, with a colorful sky in the background",
                    "A happy person, stirring something in a pan, cooking a meal, in a modern kitchen",
                    "A heroic person, riding a beautiful unicorn, galloping through a rainbow, in a fantasy landscape",
                    "A playful person, jumping in puddles, having fun in the rain, in a city street",
                    "A busy person, typing on a laptop, working diligently, in a modern office",
                    "A delighted person, opening a gift, celebrating Christmas, in front of a Christmas tree",
                    "A thoughtful person, looking out a window, reflecting on life, in a cozy room",
                ],
                input_image: "static/images/teaser_webp/ppr10k_2/input.webp",
                images: [
                    "static/images/teaser_webp/ppr10k_2/jungle.webp",
                    "static/images/teaser_webp/ppr10k_2/surfing.webp",
                    "static/images/teaser_webp/ppr10k_2/bicycle.webp",
                    "static/images/teaser_webp/ppr10k_2/sketch.webp",
                    "static/images/teaser_webp/ppr10k_2/flower.webp",
                    "static/images/teaser_webp/ppr10k_2/guitar.webp",
                    "static/images/teaser_webp/ppr10k_2/cooking.webp",
                    "static/images/teaser_webp/ppr10k_2/unicorn.webp",
                    "static/images/teaser_webp/ppr10k_2/rainy.webp",
                    "static/images/teaser_webp/ppr10k_2/laptop.webp",
                    "static/images/teaser_webp/ppr10k_2/gift.webp",
                    "static/images/teaser_webp/ppr10k_2/reflect.webp",
                ]
            },

            {
                title: [
                    "A happy person, standing on a branch, climbing a tree, surrounded by a dense jungle",
                    "A joyful person, standing on a board, surfing a wave, in the ocean",
                    "An angry person, leaning forward, riding a bicycle on a cobblestone street, surrounded by old buildings",
                    "A focused person, sitting on a rock, sketching on paper, with mountains in the background",
                    "A focused person, kneeling down, planting flowers, with a modern house in the background",
                    "A peaceful person, sitting, playing guitar at sunset, with a colorful sky in the background",
                    "A happy person, stirring something in a pan, cooking a meal, in a modern kitchen",
                    "A heroic person, riding a beautiful unicorn, galloping through a rainbow, in a fantasy landscape",
                    "A playful person, jumping in puddles, having fun in the rain, in a city street",
                    "A busy person, typing on a laptop, working diligently, in a modern office",
                    "A delighted person, opening a gift, celebrating Christmas, in front of a Christmas tree",
                    "A thoughtful person, looking out a window, reflecting on life, in a cozy room",
                ],
                input_image: "static/images/teaser_webp/ppr10k_3/input.webp",
                images: [
                    "static/images/teaser_webp/ppr10k_3/jungle.webp",
                    "static/images/teaser_webp/ppr10k_3/surfing.webp",
                    "static/images/teaser_webp/ppr10k_3/bicycle.webp",
                    "static/images/teaser_webp/ppr10k_3/sketch.webp",
                    "static/images/teaser_webp/ppr10k_3/flower.webp",
                    "static/images/teaser_webp/ppr10k_3/guitar.webp",
                    "static/images/teaser_webp/ppr10k_3/cooking.webp",
                    "static/images/teaser_webp/ppr10k_3/unicorn.webp",
                    "static/images/teaser_webp/ppr10k_3/rainy.webp",
                    "static/images/teaser_webp/ppr10k_3/laptop.webp",
                    "static/images/teaser_webp/ppr10k_3/gift.webp",
                    "static/images/teaser_webp/ppr10k_3/reflect.webp",
                ]
            },

            {
                title: [
                    "A happy person, standing on a branch, climbing a tree, surrounded by a dense jungle",
                    "A joyful person, standing on a board, surfing a wave, in the ocean",
                    "An angry person, leaning forward, riding a bicycle on a cobblestone street, surrounded by old buildings",
                    "A focused person, sitting on a rock, sketching on paper, with mountains in the background",
                    "A focused person, kneeling down, planting flowers, with a modern house in the background",
                    "A peaceful person, sitting, playing guitar at sunset, with a colorful sky in the background",
                    "A happy person, stirring something in a pan, cooking a meal, in a modern kitchen",
                    "A heroic person, riding a beautiful unicorn, galloping through a rainbow, in a fantasy landscape",
                    "A playful person, jumping in puddles, having fun in the rain, in a city street",
                    "A busy person, typing on a laptop, working diligently, in a modern office",
                    "A delighted person, opening a gift, celebrating Christmas, in front of a Christmas tree",
                    "A thoughtful person, looking out a window, reflecting on life, in a cozy room",
                ],
                input_image: "static/images/teaser_webp/sshq_1/input.webp",
                images: [
                    "static/images/teaser_webp/sshq_1/jungle.webp",
                    "static/images/teaser_webp/sshq_1/surfing.webp",
                    "static/images/teaser_webp/sshq_1/bicycle.webp",
                    "static/images/teaser_webp/sshq_1/sketch.webp",
                    "static/images/teaser_webp/sshq_1/flower.webp",
                    "static/images/teaser_webp/sshq_1/guitar.webp",
                    "static/images/teaser_webp/sshq_1/cooking.webp",
                    "static/images/teaser_webp/sshq_1/unicorn.webp",
                    "static/images/teaser_webp/sshq_1/rainy.webp",
                    "static/images/teaser_webp/sshq_1/laptop.webp",
                    "static/images/teaser_webp/sshq_1/gift.webp",
                    "static/images/teaser_webp/sshq_1/reflect.webp",
                ]
            },

            {
                title: [
                    "A happy person, standing on a branch, climbing a tree, surrounded by a dense jungle",
                    "A joyful person, standing on a board, surfing a wave, in the ocean",
                    "An angry person, leaning forward, riding a bicycle on a cobblestone street, surrounded by old buildings",
                    "A focused person, sitting on a rock, sketching on paper, with mountains in the background",
                    "A focused person, kneeling down, planting flowers, with a modern house in the background",
                    "A peaceful person, sitting, playing guitar at sunset, with a colorful sky in the background",
                    "A happy person, stirring something in a pan, cooking a meal, in a modern kitchen",
                    "A heroic person, riding a beautiful unicorn, galloping through a rainbow, in a fantasy landscape",
                    "A playful person, jumping in puddles, having fun in the rain, in a city street",
                    "A busy person, typing on a laptop, working diligently, in a modern office",
                    "A delighted person, opening a gift, celebrating Christmas, in front of a Christmas tree",
                    "A thoughtful person, looking out a window, reflecting on life, in a cozy room",
                ],
                input_image: "static/images/teaser_webp/sshq_2/input.webp",
                images: [
                    "static/images/teaser_webp/sshq_2/jungle.webp",
                    "static/images/teaser_webp/sshq_2/surfing.webp",
                    "static/images/teaser_webp/sshq_2/bicycle.webp",
                    "static/images/teaser_webp/sshq_2/sketch.webp",
                    "static/images/teaser_webp/sshq_2/flower.webp",
                    "static/images/teaser_webp/sshq_2/guitar.webp",
                    "static/images/teaser_webp/sshq_2/cooking.webp",
                    "static/images/teaser_webp/sshq_2/unicorn.webp",
                    "static/images/teaser_webp/sshq_2/rainy.webp",
                    "static/images/teaser_webp/sshq_2/laptop.webp",
                    "static/images/teaser_webp/sshq_2/gift.webp",
                    "static/images/teaser_webp/sshq_2/reflect.webp",
                ]
            },

            {
                title: [
                    "A happy person, standing on a branch, climbing a tree, surrounded by a dense jungle",
                    "A joyful person, standing on a board, surfing a wave, in the ocean",
                    "An angry person, leaning forward, riding a bicycle on a cobblestone street, surrounded by old buildings",
                    "A focused person, sitting on a rock, sketching on paper, with mountains in the background",
                    "A focused person, kneeling down, planting flowers, with a modern house in the background",
                    "A peaceful person, sitting, playing guitar at sunset, with a colorful sky in the background",
                    "A happy person, stirring something in a pan, cooking a meal, in a modern kitchen",
                    "A heroic person, riding a beautiful unicorn, galloping through a rainbow, in a fantasy landscape",
                    "A playful person, jumping in puddles, having fun in the rain, in a city street",
                    "A busy person, typing on a laptop, working diligently, in a modern office",
                    "A delighted person, opening a gift, celebrating Christmas, in front of a Christmas tree",
                    "A thoughtful person, looking out a window, reflecting on life, in a cozy room",
                ],
                input_image: "static/images/teaser_webp/sshq_3/input.webp",
                images: [
                    "static/images/teaser_webp/sshq_3/jungle.webp",
                    "static/images/teaser_webp/sshq_3/surfing.webp",
                    "static/images/teaser_webp/sshq_3/bicycle.webp",
                    "static/images/teaser_webp/sshq_3/sketch.webp",
                    "static/images/teaser_webp/sshq_3/flower.webp",
                    "static/images/teaser_webp/sshq_3/guitar.webp",
                    "static/images/teaser_webp/sshq_3/cooking.webp",
                    "static/images/teaser_webp/sshq_3/unicorn.webp",
                    "static/images/teaser_webp/sshq_3/rainy.webp",
                    "static/images/teaser_webp/sshq_3/laptop.webp",
                    "static/images/teaser_webp/sshq_3/gift.webp",
                    "static/images/teaser_webp/sshq_3/reflect.webp",
                ]
            },
            
        ]
    },
    "tryon": {
        "use_20": false,
        "use_two_sided": true,
        "garments": {
            "upper": [
                "static/images/application/virtual-tryon/clothes/upper1.webp",
                "static/images/application/virtual-tryon/clothes/upper2.webp"
            ],
            "lower": [
                "static/images/application/virtual-tryon/clothes/lower1.webp",
                "static/images/application/virtual-tryon/clothes/lower2.webp"
            ],
            "shoes": [
                "static/images/application/virtual-tryon/clothes/shoes1.webp",
                "static/images/application/virtual-tryon/clothes/shoes2.webp"
            ]
        },
        "data" : [
            {
                title: [
                    "A focused person, kneeling down, planting flowers, with a modern house in the background",
                    "A focused person, kneeling down, planting flowers, with a modern house in the background",
                ],
                input_image: "static/images/application/virtual-tryon/input.png",
                images: [
                    "static/images/application/virtual-tryon/1-1-1-flower1.webp",
                    "static/images/application/virtual-tryon/1-1-1-flower2.webp",
                ]
            },
            {
                title: [
                    "A focused person, sitting on a rock, sketching on paper, with mountains in the background",
                    "A focused person, sitting on a rock, sketching on paper, with mountains in the background"
                ],
                input_image: "static/images/application/virtual-tryon/input.png",
                images: [
                    "static/images/application/virtual-tryon/1-1-2-mountain1.webp",
                    "static/images/application/virtual-tryon/1-1-2-mountain2.webp"
                ]
            },
            {
                title: [
                    "A happy person, standing on a branch, climbing a tree, surrounded by a dense jungle",
                    "A happy person, standing on a branch, climbing a tree, surrounded by a dense jungle"
                ],
                input_image: "static/images/application/virtual-tryon/input.png",
                images: [
                    "static/images/application/virtual-tryon/1-2-1-jungle1.webp",
                    "static/images/application/virtual-tryon/1-2-1-jungle2.webp"
                ]
            },
            {
                title: [
                    "An angry person, leaning forward, riding a bicycle on a cobblestone street, surrounded by old buildings",
                    "An angry person, leaning forward, riding a bicycle on a cobblestone street, surrounded by old buildings"
                ],
                input_image: "static/images/application/virtual-tryon/input.png",
                images: [
                    "static/images/application/virtual-tryon/1-2-2-bike1.webp",
                    "static/images/application/virtual-tryon/1-2-2-bike2.webp"
                ]
            },
            {
                title: [
                    "A proud person, standing and smiling broadly, holding a trophy, in the Olympic Stadium",
                    "A proud person, standing and smiling broadly, holding a trophy, in the Olympic Stadium"
                ],
                input_image: "static/images/application/virtual-tryon/input.png",
                images: [
                    "static/images/application/virtual-tryon/2-1-1-trophy1.webp",
                    "static/images/application/virtual-tryon/2-1-1-trophy2.webp"
                ]
            },
            {
                title: [ 
                    "An excited person, walking ahead, carrying shopping bags on a busy Japanese street",
                    "An excited person, walking ahead, carrying shopping bags on a busy Japanese street"
                ],
                input_image: "static/images/application/virtual-tryon/input.png",
                images: [
                    "static/images/application/virtual-tryon/2-1-2-shopping1.webp",
                    "static/images/application/virtual-tryon/2-1-2-shopping2.webp"
                                ]
            },
            {
                title: [
                    "A peaceful person, sitting, playing guitar at sunset, with a colorful sky in the background",
                    "A peaceful person, sitting, playing guitar at sunset, with a colorful sky in the background"
                ],
                input_image: "static/images/application/virtual-tryon/input.png",
                images: [
                    "static/images/application/virtual-tryon/2-2-1-guitar1.webp",
                    "static/images/application/virtual-tryon/2-2-1-guitar2.webp",
                ]
            },
            {
                title: [ 
                    "A playful person, jumping in puddles, having fun in the rain, in a city street",
                    "A playful person, jumping in puddles, having fun in the rain, in a city street"
                ],
                input_image: "static/images/application/virtual-tryon/input.png",
                images: [
                    "static/images/application/virtual-tryon/2-2-2-rain1.webp",
                    "static/images/application/virtual-tryon/2-2-2-rain2.webp"
                ]
            },

        ]
    },
    "stylization": {
        "use_20": false,
        "use_two_sided": true,
        "data" : [
            {
                title: [
                    "Style: Anime artwork | Prompt: A delighted person, opening a gift, celebrating Christmas, in front of a Christmas tree",
                    "Style: Line art drawing | Prompt: A joyful person, stanading on a board, surfing a wave, in the ocean",
                    "Style: Abstract expressionist painting | Prompt: An angry person, leaning forward, riding a bicycle on a cobblestone street, surrounded by old buildings",
                ],
                input_image: "static/images/application/stylization/input1/input.webp",
                images: [
                    "static/images/application/stylization/input1/anime.webp",
                    "static/images/application/stylization/input1/line.webp",
                    "static/images/application/stylization/input1/abstract.webp"
                ]
            },
            {
                title: [
                    "Style: Graffiti | Prompt: A thoughtful person, looking out a window, reflecting on life, in a cozy room",
                    "Style: Watercolor painting | Prompt: A playful person, jumping in puddles, having fun in the rain, in a city street",
                    "Style: Ethereal fantasy concept art | Prompt: An excited person, walking ahead, carrying shopping bags on a busy Japanese street",
                ],
                input_image: "static/images/application/stylization/input2/input.webp",
                images: [
                    "static/images/application/stylization/input2/graffiti.webp",
                    "static/images/application/stylization/input2/watercolor.webp",
                    "static/images/application/stylization/input2/fantasy.webp"
                ]
            },
            {
                title: [
                    "Style: Pop Art | Prompt: A peaceful person, sitting, playing guitar at sunset, with a colorful sky in the background",
                    "Style: Play-doh | Prompt: A happy person, stirring something in a pan, cooking a meal, in a modern kitchen",
                    "Style: Pixel-art | Prompt: A passionate person, extending both arms, dancing on a wooden floor in a dimly lit room"
                ],
                input_image: "static/images/application/stylization/input3/input.webp",
                images: [
                    "static/images/application/stylization/input3/popart.webp",
                    "static/images/application/stylization/input3/play.webp",
                    "static/images/application/stylization/input3/pixel-art.webp",
                ]
            },
            {
                title: [
                    "Style: Art nouveau | Prompt: A busy person, typing on a laptop, working diligently, in a modern office",
                    "Style: Cubist artwork | Prompt: A tired person, running mid-stride, jogging through a city, surrounded by tall buildings",
                    "Style: Comic | Prompt: A focused person, kneeling down, planting flowers, with a modern house in the background",
                ],
                input_image: "static/images/application/stylization/input4/input.webp",
                images: [
                    "static/images/application/stylization/input4/nouveau.webp",
                    "static/images/application/stylization/input4/cubist.webp",
                    "static/images/application/stylization/input4/comic.webp"
                ]
            }
        ]
    },
    "character": {
        "use_20": false,
        "use_two_sided": true,
        "data" : [
            {
                title: [
                    "A satisfied person, sitting on a park bench, eating a sandwich, surrounded by trees",
                    "A proud person, standing and smiling broadly, holding a trophy, in the Olympic Stadium",
                    "A delighted person, opening a gift, celebrating Christmas, in front of a Christmas tree"
                ],
                input_image: "static/images/application/character/input1/input.webp",
                images: [
                    "static/images/application/character/input1/sand.webp",
                    "static/images/application/character/input1/trophy.webp",
                    "static/images/application/character/input1/gift.webp",
                ]
            },
            {
                title: [
                    "A curious person, running, exploring an ancient castle, in a magical realm",
                    "An excited person, walking ahead, carrying shopping bags on a busy Japanese street",
                    "A playful person, jumping in puddles, having fun in the rain, in a city street"
                ],
                input_image: "static/images/application/character/input2/input.webp",
                images: [
                    "static/images/application/character/input2/castle.webp",
                    "static/images/application/character/input2/shopping.webp",
                    "static/images/application/character/input2/puddle.webp"
                ]
            },
            {
                title: [
                    "A passionate person, extending both arms, dancing on a wooden floor in a dimly lit room",
                    "A heroic person, riding a beautiful unicorn, galloping through a rainbow, in a fantasy landscape",
                    "A busy person, typing on a laptop, working diligently, in a modern office"
                ],
                input_image: "static/images/application/character/input3/input.webp",
                images: [
                    "static/images/application/character/input3/dancing.webp",
                    "static/images/application/character/input3/unicorn.webp",
                    "static/images/application/character/input3/laptop.webp"
                ]
            }
        ]
    }
};

let slideIndex = 1;
let currentSceneIndex = {};
let twenty_inited = {};
for (let i = 0; i < tasks.length; i++) {
    currentSceneIndex[tasks[i]] = 0;
    twenty_inited[tasks[i]] = false;
}

const garmentSelected = {
    A: "1",
    B: "1",
    C: "1"
};

// Mapping combinations to images
const tryonSceneIndex = {
    "1-1-1": "0",
    "1-1-2": "1",
    "1-2-1": "2",
    "1-2-2": "3",
    "2-1-1": "4",
    "2-1-2": "5",
    "2-2-1": "6",
    "2-2-2": "7"
};

const sceneIndexToInput = [
    "1-1-1",
    "1-1-2",
    "1-2-1",
    "1-2-2",
    "2-1-1",
    "2-1-2",
    "2-2-1",
    "2-2-2",
]

// Generate the slides and thumbnails dynamically
function generateSlides(taskName) {
    const slideshowContainer = $("#" + taskName + "-container");
    let slidesHTML = "";
    let thumbnailsHTML = "";
    let scenes = data[taskName]["data"];
    let use_20 = data[taskName]["use_20"];
    let use_two_sided = data[taskName]["use_two_sided"];

    if (use_20) {
        scenes.forEach((scene, sceneIndex) => {
            slidesHTML += `
                <div class="${taskName}-mySlides ${taskName}-scene-${sceneIndex} outer-container">
                    <div class="twenty-container">
            `;
            scene.images.forEach((image) => {
                slidesHTML += `
                    <img class="main-image" src="${image}" alt="${scene.title}">
                `;
            });
            slidesHTML += `
                    </div> 
                </div>
            `;

            thumbnailsHTML += `
                <div class="carousel-column">
                    <img class="${taskName}-demo cursor" src="${scene.images[0]}" data-scene-index="${sceneIndex}" alt="${scene.title}">
                </div>
            `;
        });

        slideshowContainer.html(`
            <div class="container" style="position: relative;">
                ${slidesHTML}

                <!-- Caption container -->
                <div class="caption-container">
                    <p id="${taskName}-caption">${scenes[currentSceneIndex[taskName]].title}</p>
                </div>

                <!-- Thumbnails -->
                <div class="carousel-row">
                    ${thumbnailsHTML}
                </div>
            </div>
        `);
    }
    else if (use_two_sided) {
        let slidesHTML = '';
        let thumbnailsHTML = '';
        let currentScene = scenes[currentSceneIndex[taskName]];
        let first_caption = typeof currentScene.title === 'string' ? currentScene.title : currentScene.title[0];

        scenes.forEach((scene, sceneIndex) => {
            scene.images.forEach((image, index) => {
                slidesHTML += `
                    <div class="${taskName}-mySlides ${taskName}-scene-${sceneIndex} outer-container">
                        <img class="main-image" src="${image}" alt="${scene.title}">
                    </div>
                `;
            });

            thumbnailsHTML += `
                <div class="carousel-column">
                    <img class="${taskName}-demo cursor" src="${scene.input_image}" data-scene-index="${sceneIndex}" alt="${scene.title}">
                </div>
            `;
        });

        if (taskName == 'tryon') {
            let garments = data[taskName]['garments'];
            
            thumbnailsHTML = `
                <div class="carousel-column">
                    <div class="carousel-row">
                        <img class="${taskName}-demo garmentA active cursor" src="${garments.upper[0]}" data-group="A" data-value="1">
                        <img class="${taskName}-demo garmentA cursor" src="${garments.upper[1]}" data-group="A" data-value="2">
                    </div>
                </div>
                <div class="carousel-column">
                    <div class="carousel-row">
                        <img class="${taskName}-demo garmentB active cursor" src="${garments.lower[0]}" data-group="B" data-value="1"">
                        <img class="${taskName}-demo garmentB cursor" src="${garments.lower[1]}" data-group="B" data-value="2">
                    </div>
                </div>
                <div class="carousel-column">
                    <div class="carousel-row">
                        <img class="${taskName}-demo garmentC active cursor" src="${garments.shoes[0]}" data-group="C" data-value="1">
                        <img class="${taskName}-demo garmentC cursor" src="${garments.shoes[1]}" data-group="C" data-value="2">
                    </div>
                </div>
                
            `;
        }

        const inputImageHTML = `
            <div class="col-sm-4" style="height: 100%; max-width: 50%">
                <img class="main-image" src="${currentScene.input_image}" alt="Input Image">
            </div>
        `;

        const carouselHTML = `
            <div class="col-sm-8 container">
                <div style="position: relative;">
                    ${slidesHTML}
                    ${scenes[0].images.length > 1 ? `
                        <a class="two-prev" data-task-name="${taskName}">❮</a>
                        <a class="two-next" data-task-name="${taskName}">❯</a>
                    ` : ''}
                </div>
            </div>
        `;

        slideshowContainer.html(`
            <div class="container">
                <div class="row" style="height: 500px; max-width: 100%; background: #f5f5f5; margin: 0; display: flex">
                    ${inputImageHTML}
                    ${carouselHTML}
                </div>
                <div class="caption-container">
                    <p id="${taskName}-caption">${first_caption}</p>
                </div>
                <div class="carousel-row">
                    ${thumbnailsHTML}
                </div>
            </div>
        `);
    }
    else {
        scenes.forEach((scene, sceneIndex) => {
            scene.images.forEach((image, index) => {
                slidesHTML += `
                    <div class="${taskName}-mySlides ${taskName}-scene-${sceneIndex} outer-container">
                        <div class="numbertext">${sceneIndex + 1}.${index + 1} / ${scene.images.length}</div>
                        <img class="main-image" src="${image}" alt="${scene.title}">
                    </div>
                `;
            });

            thumbnailsHTML += `
                <div class="carousel-column">
                    <img class="${taskName}-demo cursor" src="${scene.images[0]}" data-scene-index="${sceneIndex}" alt="${scene.title}">
                </div>
            `;
        });
        if (scenes[0].images.length > 1) { 
            slideshowContainer.html(`
                <div class="container" style="position: relative;">
                    ${slidesHTML}

                    <!-- Navigation arrows -->
                    <a class="prev" data-task-name="${taskName}">❮</a>
                    <a class="next" data-task-name="${taskName}">❯</a>

                    <!-- Caption container -->
                    <div class="caption-container">
                        <p id="${taskName}-caption">${scenes[currentSceneIndex[taskName]].title}</p>
                    </div>

                    <!-- Thumbnails -->
                    <div class="carousel-row">
                        ${thumbnailsHTML}
                    </div>
                </div>
            `);
        }
        else{
            slideshowContainer.html(`
                <div class="container" style="position: relative;">
                    ${slidesHTML}

                    <!-- Caption container -->
                    <div class="caption-container">
                        <p id="${taskName}-caption">${scenes[currentSceneIndex[taskName]].title}</p>
                    </div>

                    <!-- Thumbnails -->
                    <div class="carousel-row">
                        ${thumbnailsHTML}
                    </div>
                </div>
            `);
        }
    }

    // Initialize the first slide
    showSlides(slideIndex, taskName);
}

function plusSlides(n, taskName) {
    let scenes = data[taskName]["data"];
    if (n > 0) {
        console.log(currentSceneIndex[taskName])
        if (slideIndex === scenes[currentSceneIndex[taskName]].images.length) {
            slideIndex = 1;
        } else {
            slideIndex += n;
        }
    } else {
        if (slideIndex === 1) {
            slideIndex = scenes[currentSceneIndex[taskName]].images.length;
        } else {
            slideIndex += n;
        }
    }

    showSlides(slideIndex, taskName);
}

function showScene(sceneIndex, taskName) {
    currentSceneIndex[taskName] = sceneIndex;
    slideIndex = 1;
    showSlides(slideIndex, taskName);
}

function showSlides(n, taskName) {
    console.log("showSlides", n, taskName);
    let slides = $(`.${taskName}-mySlides`);
    let dots = $(`.${taskName}-demo`);
    let captionText = $(`#${taskName}-caption`);
    let scenes = data[taskName]["data"];
    let use_20 = data[taskName]["use_20"];
    let use_two_sided = data[taskName]["use_two_sided"];

    if (n > slides.length) { slideIndex = 1; }
    if (n < 1) { slideIndex = slides.length; }

    slides.hide();
    dots.removeClass("active");

    if (use_20) {
        let sceneSlides = $(`.${taskName}-scene-${currentSceneIndex[taskName]}`);
        sceneSlides.eq(slideIndex - 1).show();

        $(".twenty-container").twentytwenty();
        $(".twenty-container").css("height", "500px");
    } else if (use_two_sided) {
        // Update the input image on the left side
        let currentScene = scenes[currentSceneIndex[taskName]];
        $(`#${taskName}-container .col-sm-4 img`).attr('src', currentScene.input_image);
        
        // Show the current slide on the right side
        let sceneSlides = $(`.${taskName}-scene-${currentSceneIndex[taskName]}`);
        sceneSlides.eq(slideIndex - 1).show();
    } else {
        let sceneSlides = $(`.${taskName}-scene-${currentSceneIndex[taskName]}`);
        sceneSlides.eq(slideIndex - 1).show();
    }

    if (taskName == 'tryon') {
        let currentKey = sceneIndexToInput[Number(currentSceneIndex[taskName])];
        let a = currentKey.split("-")[0];
        let b = currentKey.split("-")[1];
        let c = currentKey.split("-")[2];

        $(`.tryon-demo[data-group="A"][data-value=${a}]`).addClass("active");
        $(`.tryon-demo[data-group="B"][data-value=${b}]`).addClass("active");
        $(`.tryon-demo[data-group="C"][data-value=${c}]`).addClass("active");
        
    } else {
        dots.eq(currentSceneIndex[taskName]).addClass("active");
    }
    
    if (typeof scenes[currentSceneIndex[taskName]].title === 'string') {
        captionText.html(scenes[currentSceneIndex[taskName]].title);
    } else {
        captionText.html(scenes[currentSceneIndex[taskName]].title[slideIndex - 1]);
    }
}

// Generate the slides on page load
$(document).ready(function() {
    tasks.forEach(task => {
        generateSlides(task);
    });

    // Tab Logic
    $('.nav-tabs a').on('click', function(e) {
        e.preventDefault();

        let targetId = $(this).attr('href');

        // Update active tab
        $('.nav-tabs li').removeClass('active');
        $(this).parent('li').addClass('active');

        // Update tab content
        $('.tab-pane').removeClass('in active').addClass('fade');
        $(targetId).addClass('in active').removeClass('fade');
        $('#teaser-container').addClass('in active');
        
        // split using "-" and get the first element
        let taskName = targetId.split("-")[0].replace("#", "");
        console.log("Tab clicked", taskName);

        $(`.${taskName}-mySlides`).each(function() {
            const $slide = $(this);
            const $container = $slide.find('.twenty-container');
            
            console.log($container)

            // Remove only the overlay within this slide
            $('.twentytwenty-overlay').remove();
            
            // Remove only the handle within this slide
            $('.twentytwenty-handle').remove();
            
            // bug still persists.
            // console.log($slide.find(`.${taskName}-wrapper`))
            
            // // Move the container outside the wrapper but keep it within image2pose-mySlides
            // $container.insertBefore($container.parent().parent());
            
            // Remove the empty wrapper within this slide
            // $slide.find('.twentytwenty-wrapper').remove();
            
            // // Clean up any remaining empty elements within this slide
            // $slide.find('.twentytwenty-wrapper').each(function() {
            //     if ($(this).children().length === 0) {
            //         $(this).remove();
            //     }
            // });
            
            // console.log($slide.find('.twenty-container'))
            // $slide.find('.twenty-container').twentytwenty();
            // $slide.find('.twenty-container').css("height", "500px");
        });
        
        $('.twenty-container').twentytwenty();
        $('.twenty-container').css("height", "500px");
        twenty_inited[targetId] = true;
    });

    // Thumbnail click event
    $(document).on('click', '.cursor', function() {
        let taskName = $(this).attr('class').split('-')[0];
        if (taskName == 'tryon') {
            let group = $(this).attr('data-group');
            let value = $(this).attr('data-value');
            garmentSelected[group] = value;
            let sceneIndex = tryonSceneIndex[`${garmentSelected.A}-${garmentSelected.B}-${garmentSelected.C}`]
            showScene(sceneIndex, taskName);
        } else {
            let sceneIndex = $(this).data('scene-index');
            showScene(sceneIndex, taskName);
        }
    });

    // Navigation arrows click event
    $(document).on('click', '.prev, .next, .two-prev, .two-next', function() {
        let taskName = $(this).data('task-name');
        let direction = ($(this).hasClass('prev') || $(this).hasClass('two-prev')) ? -1 : 1;
        plusSlides(direction, taskName);
    });
});